---
title: C-07预编译
date: 2020-08-07 10:00:00
tags:
    - C
---

## 宏
格式

`#define   宏名    宏内容`

```c
#define    PI      3.141592
#define   s(x,y)    x*y+2   
//（先替换，再计算，不要乱加括号，按优先级计算）
```

1. 宏名：符号常量
2. 无语法检查
3. 无类型

```c
#include <stdio.h>
#include <syslog.h> 
#define NAME(n) int_##n
#define PRINT_MACRO_HELPER(x) #x 
#define PRINT_MACRO(x) PRINT_MACRO_HELPER(x)

#define PRINTF_PCARH_VAR(var) printf(#var "=%s\n", var)

#define LOG_PRINT(str) do {                                  \
    syslog(LOG_INFO, "%s, %s, %d, %s",  __FILE__, __func__, __LINE__, str); \
} while (0)                                                  \

int main()
{
    
    int NAME(a);
    int NAME(b);
 
    NAME(a) = 520;
    NAME(b) = 111;

    printf("MACRO_NAME,  VAR_NAME, VALUE\n");
    printf("%10s,%10s,%6d\n", PRINT_MACRO_HELPER(NAME(a)),PRINT_MACRO(NAME(a)), NAME(a));
    printf("%10s,%10s,%6d\n", PRINT_MACRO_HELPER(NAME(b)),PRINT_MACRO(NAME(b)), NAME(b));
    

    //将实参代入宏文本中
    //如果实参也是宏，则展开实参
    //宏展开后遇到#或者##将不在继续展开

    // -> #NAME(i) NAME(i)还是一个宏,但是遇到#无法继续展开
    printf("%s\n", PRINT_MACRO_HELPER(NAME(i))); // 

    // -> PRINT_MACRO_HELPER(NAME(i))  NAME(i)还是一个宏，继续展开
    // -> PRINT_MACRO_HELPER(int_i)
    // -> #int_i
    // -> "int_i"
    printf("%s\n", PRINT_MACRO(NAME(i)));  

    const char *p = "hhhhh";
    PRINTF_PCARH_VAR(p);

    LOG_PRINT("abc");

    return 0;
}
```