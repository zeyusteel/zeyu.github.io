---
title: User Namespace
date: 2022-07-14 08:49:11
tags:
    - Linux
---

## 描述
用户命名空间隔离了安全相关的标识和属性，尤其是`uid`和`gid`(credentials)、根目录、密钥(keyrings)、能力(capabilities)。一个进程的`uid`,`gid`在不同的用户命名空间可能是不同的。一个进程在在一个命名空间外可能是一个普通的非特权用户,同时在命名空间内可能是uid = 0的root。换句话说，一个进程对一个命名空间内的操作具有完全的权限，但是对命名空间外的操作没有权限

### 嵌套用户命名空间
用户名称空间可以嵌套；也就是说，除了初始根命名空间之外，每个用户命名空间都有一个父用户命名空间，并且可以具有零个或多个子用户命名空间,父命名空间通过`unshare`、`clone`,配合使用`CLONE_NEWUSER`标志创建子命名空间。内核（>3.11)限制用户命名空间最多嵌套32层,超出限制会报`EUSERS`

每一个进程都是一个用户命名空间的成员，一个进程通过`fork`或者`clone`但是不使用`CLONE_NEWUSER`就会和父进程一样作为同一个命名空间的成员。一个进程可以通过`setns`加入另一个用户命名空间，前提是这个进程在这个用户命名空间有`CAP_SYS_ADMIN`能力,切换后这个进程将在这个用户命名空间有全部能力

ioctl中的`NS_GET_PARENT`用于获取命名空间的父子关系(ioctl_ns)

### 能力
TODO
